(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var Searcher = require('./searcher');

new Searcher('searcher');
},{"./searcher":3}],2:[function(require,module,exports){
'use strict';

module.exports = (function () {

    function Input(namespace, callback) {
        this.namespace = namespace;
        this.callback = callback;
    }

    Input.prototype.insert = function (value) {
        this.container = document.createElement('div');
        this.container.id = this.namespace + '-result';
        this.container.classList.add('result');
        this.input = document.createElement('input');
        this.input.id = this.namespace + '-input';
        this.input.classList.add('input');
        this.input.autofocus = true;
        this.input.value = value;
        this.button = document.createElement('button');
        this.button.id = this.namespace + '-button';
        this.button.classList.add('button');
        this.button.innerHTML = 'Close';
        this.time = document.createElement('span');
        this.time.id = this.namespace + '-time';
        this.time.classList.add('time');
        this.count = document.createElement('span');
        this.count.id = this.namespace + '-count';
        this.count.classList.add('count');
        this.container.appendChild(this.input);
        this.container.appendChild(this.button);
        this.container.appendChild(this.count);
        this.container.appendChild(this.time);
        document.body.insertBefore(this.container, document.body.firstChild);

        this.addListeners();

        return this;
    };

    Input.prototype.show = function (value) {

        if (!this.input) {
            this.insert(value);
        } else {
            this.input.value = value;
            this.container.style.display = 'block';
        }

        return this;
    };

    Input.prototype.hide = function () {
        this.container.style.display = 'none';

        return this;
    };

    Input.prototype.addListeners = function () {

        if (this.input) {
            this.input.addEventListener('input', this.callback, false);
        }

        if (this.button) {
            this.button.addEventListener('click', this.onClick.bind(this), false);
        }

        return this;
    };

    Input.prototype.onClick = function () {
        this.enable().hide();
        this.input.value = '';

        return this;
    };

    Input.prototype.setTime = function (time) {

        if (this.time) {
            this.time.innerHTML = time;
        }

        return this;
    };

    Input.prototype.setCount = function (count) {

        if (this.count) {
            this.count.innerHTML = count;
        }

        return this;
    };

    return Input;
})();
},{}],3:[function(require,module,exports){
'use strict';

var Input = require('./input');

module.exports = (function () {
    var START_LENGTH = 3,
        _isBusy = false;

    function Searcher(namespace) {
        this.namespace = namespace;
        this.container = document.getElementById(this.namespace + '-container');
        this.itemPrefix = this.namespace + '-container-item-';
        this.storage = [];
        this.time = {
            start: 0,
            end: 0
        };

        this.onLoad().addKeyListener();
    }

    Searcher.prototype.onLoad = function () {
        var i;

        if (this.container) {
            this.items = this.container.getElementsByTagName('*');

            for (i = this.items.length; i--;) {
                this.items[i].id = this.itemPrefix + i;
                this.storage[this.storage.length] = this.items[i].textContent;
            }
            this.binarySearch = new Worker('app/binary-search.js');
            this.input = new Input(this.namespace + '-input', this.onInput.bind(this));
            this.value = '';

            this.addWorkerListener();
        }

        return this;
    };

    Searcher.prototype.isAllowed = function () {
        return !_isBusy && this.value.length >= START_LENGTH;
    };

    Searcher.prototype.addKeyListener = function () {
        document.addEventListener('keypress', this.onKey.bind(this));

        return this;
    };

    Searcher.prototype.onKey = function (event) {

        if (!_isBusy) {
            if (this.value.length < START_LENGTH) {
                this.value += String.fromCharCode(event.keyCode || event.which);
            }

            if (this.isAllowed()) {
                this.show();
            }
        }

        return this;
    };

    Searcher.prototype.show = function () {

        if (this.input) {
            this.input.show(this.value);
        } else {
            this.insert(this.value);
        }
        this.search();

        return this;
    };

    Searcher.prototype.onInput = function (event) {
        this.value = event.target.value;

        this.search();

        return this;
    };

    Searcher.prototype.addWorkerListener = function () {
        this.binarySearch.addEventListener('message', this.onMessage.bind(this), false);

        return this;
    };

    Searcher.prototype.search = function () {

        if (this.isAllowed()) {
            this.time.start = performance.now();
            this.disable();
            this.binarySearch.postMessage({
                arr: this.storage,
                value: this.value
            });
        }

        return this;
    };

    Searcher.prototype.disable = function () {
        _isBusy = true;

        return this;
    };

    Searcher.prototype.enable = function () {
        _isBusy = false;

        return this;
    };

    Searcher.prototype.onMessage = function (event) {
        var i;

        this.time.end = performance.now();
        this.enable()
            .input.setTime(this.time.end - this.time.start).setCount(event.data.length);

        for (i = event.data.length; i--;) {
            document.getElementById(this.itemPrefix + event.data[i]).style.display = 'block';
        }

        return this;
    };

    return Searcher;
})();
},{"./input":2}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy92aWt0b3IvRG9jdW1lbnRzL0RldmVsb3BtZW50L0pTL3V3YzE1L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy92aWt0b3IvRG9jdW1lbnRzL0RldmVsb3BtZW50L0pTL3V3YzE1L2FwcC9mYWtlXzI4ZDcwMzcxLmpzIiwiL1VzZXJzL3Zpa3Rvci9Eb2N1bWVudHMvRGV2ZWxvcG1lbnQvSlMvdXdjMTUvYXBwL2lucHV0LmpzIiwiL1VzZXJzL3Zpa3Rvci9Eb2N1bWVudHMvRGV2ZWxvcG1lbnQvSlMvdXdjMTUvYXBwL3NlYXJjaGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbnZhciBTZWFyY2hlciA9IHJlcXVpcmUoJy4vc2VhcmNoZXInKTtcblxubmV3IFNlYXJjaGVyKCdzZWFyY2hlcicpOyIsIid1c2Ugc3RyaWN0JztcblxubW9kdWxlLmV4cG9ydHMgPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgZnVuY3Rpb24gSW5wdXQobmFtZXNwYWNlLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cblxuICAgIElucHV0LnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuaWQgPSB0aGlzLm5hbWVzcGFjZSArICctcmVzdWx0JztcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgncmVzdWx0Jyk7XG4gICAgICAgIHRoaXMuaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB0aGlzLmlucHV0LmlkID0gdGhpcy5uYW1lc3BhY2UgKyAnLWlucHV0JztcbiAgICAgICAgdGhpcy5pbnB1dC5jbGFzc0xpc3QuYWRkKCdpbnB1dCcpO1xuICAgICAgICB0aGlzLmlucHV0LmF1dG9mb2N1cyA9IHRydWU7XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5idXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgdGhpcy5idXR0b24uaWQgPSB0aGlzLm5hbWVzcGFjZSArICctYnV0dG9uJztcbiAgICAgICAgdGhpcy5idXR0b24uY2xhc3NMaXN0LmFkZCgnYnV0dG9uJyk7XG4gICAgICAgIHRoaXMuYnV0dG9uLmlubmVySFRNTCA9ICdDbG9zZSc7XG4gICAgICAgIHRoaXMudGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgdGhpcy50aW1lLmlkID0gdGhpcy5uYW1lc3BhY2UgKyAnLXRpbWUnO1xuICAgICAgICB0aGlzLnRpbWUuY2xhc3NMaXN0LmFkZCgndGltZScpO1xuICAgICAgICB0aGlzLmNvdW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB0aGlzLmNvdW50LmlkID0gdGhpcy5uYW1lc3BhY2UgKyAnLWNvdW50JztcbiAgICAgICAgdGhpcy5jb3VudC5jbGFzc0xpc3QuYWRkKCdjb3VudCcpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmlucHV0KTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5idXR0b24pO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNvdW50KTtcbiAgICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy50aW1lKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRCZWZvcmUodGhpcy5jb250YWluZXIsIGRvY3VtZW50LmJvZHkuZmlyc3RDaGlsZCk7XG5cbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcnMoKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgSW5wdXQucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAodmFsdWUpIHtcblxuICAgICAgICBpZiAoIXRoaXMuaW5wdXQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIElucHV0LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBJbnB1dC5wcm90b3R5cGUuYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIGlmICh0aGlzLmlucHV0KSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5jYWxsYmFjaywgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uKSB7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljay5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgSW5wdXQucHJvdG90eXBlLm9uQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZW5hYmxlKCkuaGlkZSgpO1xuICAgICAgICB0aGlzLmlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIElucHV0LnByb3RvdHlwZS5zZXRUaW1lID0gZnVuY3Rpb24gKHRpbWUpIHtcblxuICAgICAgICBpZiAodGhpcy50aW1lKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWUuaW5uZXJIVE1MID0gdGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBJbnB1dC5wcm90b3R5cGUuc2V0Q291bnQgPSBmdW5jdGlvbiAoY291bnQpIHtcblxuICAgICAgICBpZiAodGhpcy5jb3VudCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudC5pbm5lckhUTUwgPSBjb3VudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICByZXR1cm4gSW5wdXQ7XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcblxudmFyIElucHV0ID0gcmVxdWlyZSgnLi9pbnB1dCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIFNUQVJUX0xFTkdUSCA9IDMsXG4gICAgICAgIF9pc0J1c3kgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIFNlYXJjaGVyKG5hbWVzcGFjZSkge1xuICAgICAgICB0aGlzLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLm5hbWVzcGFjZSArICctY29udGFpbmVyJyk7XG4gICAgICAgIHRoaXMuaXRlbVByZWZpeCA9IHRoaXMubmFtZXNwYWNlICsgJy1jb250YWluZXItaXRlbS0nO1xuICAgICAgICB0aGlzLnN0b3JhZ2UgPSBbXTtcbiAgICAgICAgdGhpcy50aW1lID0ge1xuICAgICAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgICAgICBlbmQ6IDBcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm9uTG9hZCgpLmFkZEtleUxpc3RlbmVyKCk7XG4gICAgfVxuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uTG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGk7XG5cbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gdGhpcy5jb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKTtcblxuICAgICAgICAgICAgZm9yIChpID0gdGhpcy5pdGVtcy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zW2ldLmlkID0gdGhpcy5pdGVtUHJlZml4ICsgaTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2VbdGhpcy5zdG9yYWdlLmxlbmd0aF0gPSB0aGlzLml0ZW1zW2ldLnRleHRDb250ZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5iaW5hcnlTZWFyY2ggPSBuZXcgV29ya2VyKCdhcHAvYmluYXJ5LXNlYXJjaC5qcycpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dCA9IG5ldyBJbnB1dCh0aGlzLm5hbWVzcGFjZSArICctaW5wdXQnLCB0aGlzLm9uSW5wdXQuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gJyc7XG5cbiAgICAgICAgICAgIHRoaXMuYWRkV29ya2VyTGlzdGVuZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuaXNBbGxvd2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gIV9pc0J1c3kgJiYgdGhpcy52YWx1ZS5sZW5ndGggPj0gU1RBUlRfTEVOR1RIO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuYWRkS2V5TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgdGhpcy5vbktleS5iaW5kKHRoaXMpKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uS2V5ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICAgICAgaWYgKCFfaXNCdXN5KSB7XG4gICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5sZW5ndGggPCBTVEFSVF9MRU5HVEgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWxsb3dlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuaW5wdXQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuc2hvdyh0aGlzLnZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHRoaXMudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2VhcmNoKCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5vbklucHV0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7XG5cbiAgICAgICAgdGhpcy5zZWFyY2goKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLmFkZFdvcmtlckxpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJpbmFyeVNlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2UuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIGlmICh0aGlzLmlzQWxsb3dlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWUuc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICAgICAgdGhpcy5iaW5hcnlTZWFyY2gucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIGFycjogdGhpcy5zdG9yYWdlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX2lzQnVzeSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9pc0J1c3kgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgaTtcblxuICAgICAgICB0aGlzLnRpbWUuZW5kID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIHRoaXMuZW5hYmxlKClcbiAgICAgICAgICAgIC5pbnB1dC5zZXRUaW1lKHRoaXMudGltZS5lbmQgLSB0aGlzLnRpbWUuc3RhcnQpLnNldENvdW50KGV2ZW50LmRhdGEubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGkgPSBldmVudC5kYXRhLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5pdGVtUHJlZml4ICsgZXZlbnQuZGF0YVtpXSkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNlYXJjaGVyO1xufSkoKTsiXX0=
