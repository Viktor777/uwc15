(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var Searcher = require('./searcher');

new Searcher('searcher');
},{"./searcher":3}],2:[function(require,module,exports){
'use strict';

module.exports = (function () {

    function Input(namespace, callback) {
        this.namespace = namespace;
        this.callback = callback;
    }

    Input.prototype.insert = function (value) {
        this.container = document.createElement('div');
        this.container.id = this.namespace + '-result';
        this.container.classList.add('result');
        this.input = document.createElement('input');
        this.input.id = this.namespace + '-input';
        this.input.classList.add('input');
        this.input.autofocus = true;
        this.input.value = value;
        this.button = document.createElement('button');
        this.button.id = this.namespace + '-button';
        this.button.classList.add('button');
        this.button.innerHTML = 'Close';
        this.time = document.createElement('span');
        this.time.id = this.namespace + '-time';
        this.time.classList.add('time');
        this.count = document.createElement('span');
        this.count.id = this.namespace + '-count';
        this.count.classList.add('count');
        this.container.appendChild(this.input);
        this.container.appendChild(this.button);
        this.container.appendChild(this.count);
        this.container.appendChild(this.time);
        document.body.insertBefore(this.container, document.body.firstChild);

        this.addListeners();

        return this;
    };

    Input.prototype.show = function (value) {

        if (!this.input) {
            this.insert(value);
        } else {
            this.input.value = value;
            this.container.style.display = 'block';
        }

        return this;
    };

    Input.prototype.hide = function () {
        this.container.style.display = 'none';

        return this;
    };

    Input.prototype.addListeners = function () {

        if (this.input) {
            this.input.addEventListener('input', this.callback, false);
        }

        if (this.button) {
            this.button.addEventListener('click', this.onClick.bind(this), false);
        }

        return this;
    };

    Input.prototype.onClick = function () {
        this.enable().hide();
        this.input.value = '';

        return this;
    };

    Input.prototype.setTime = function (time) {

        if (this.time) {
            this.time.innerHTML = time;
        }

        return this;
    };

    Input.prototype.setCount = function (count) {

        if (this.count) {
            this.count.innerHTML = count;
        }

        return this;
    };

    return Input;
})();
},{}],3:[function(require,module,exports){
'use strict';

var Input = require('./input');

module.exports = (function () {
    var START_LENGTH = 3,
        _isBusy = false;

    function Searcher(namespace) {
        this.namespace = namespace;
        this.container = document.getElementById(this.namespace + '-container');
        this.itemPrefix = this.namespace + '-container-item-';
        this.storage = [];
        this.time = {
            start: 0,
            end: 0
        };

        this.onLoad().addKeyListener();
    }

    Searcher.prototype.onLoad = function () {
        var i;

        if (this.container) {
            this.items = this.container.getElementsByTagName('*');

            for (i = this.items.length; i--;) {
                this.items[i].id = this.itemPrefix + i;
                this.storage[this.storage.length] = this.items[i].textContent;
            }
            this.binarySearch = new Worker('app/binary-search.js');
            this.input = new Input(this.namespace + '-input', this.onInput.bind(this));
            this.value = '';

            this.addWorkerListener();
        }

        return this;
    };

    Searcher.prototype.isAllowed = function () {
        return !_isBusy && this.value.length >= START_LENGTH;
    };

    Searcher.prototype.addKeyListener = function () {
        document.addEventListener('keypress', this.onKey.bind(this));

        return this;
    };

    Searcher.prototype.removeKeyListener = function () {
        document.removeEventListener('keypress', this.onKey.bind(this));

        return this;
    };

    Searcher.prototype.onKey = function (event) {

        if (!_isBusy) {
            this.value += String.fromCharCode(event.keyCode || event.which);

            if (this.isAllowed()) {
                this.show().removeKeyListener();
            }
        }

        return this;
    };

    Searcher.prototype.show = function () {

        if (this.input) {
            this.input.show(this.value);
        } else {
            this.insert(this.value);
        }
        this.search();

        return this;
    };

    Searcher.prototype.onInput = function (event) {
        this.value = event.target.value;

        this.search();

        return this;
    };

    Searcher.prototype.addWorkerListener = function () {
        this.binarySearch.addEventListener('message', this.onMessage.bind(this), false);

        return this;
    };

    Searcher.prototype.search = function () {

        if (this.isAllowed()) {
            this.time.start = performance.now();
            this.disable();
            this.binarySearch.postMessage({
                arr: this.storage,
                value: this.value
            });
        }

        return this;
    };

    Searcher.prototype.disable = function () {
        _isBusy = true;c

        return this;
    };

    Searcher.prototype.enable = function () {
        _isBusy = false;

        return this;
    };

    Searcher.prototype.onMessage = function (event) {
        var i;

        this.time.end = performance.now();
        this.enable()
            .input.setTime(this.time.end - this.time.start).setCount(event.data.length);

        for (i = event.data.length; i--;) {
            document.getElementById(this.itemPrefix + event.data[i]).style.display = 'block';
        }

        return this;
    };

    return Searcher;
})();
},{"./input":2}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy92aWt0b3IvRG9jdW1lbnRzL0RldmVsb3BtZW50L0pTL3V3YzE1L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy92aWt0b3IvRG9jdW1lbnRzL0RldmVsb3BtZW50L0pTL3V3YzE1L2FwcC9mYWtlXzU4NjZkNzNlLmpzIiwiL1VzZXJzL3Zpa3Rvci9Eb2N1bWVudHMvRGV2ZWxvcG1lbnQvSlMvdXdjMTUvYXBwL2lucHV0LmpzIiwiL1VzZXJzL3Zpa3Rvci9Eb2N1bWVudHMvRGV2ZWxvcG1lbnQvSlMvdXdjMTUvYXBwL3NlYXJjaGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIFNlYXJjaGVyID0gcmVxdWlyZSgnLi9zZWFyY2hlcicpO1xuXG5uZXcgU2VhcmNoZXIoJ3NlYXJjaGVyJyk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICBmdW5jdGlvbiBJbnB1dChuYW1lc3BhY2UsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlO1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgSW5wdXQucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5pZCA9IHRoaXMubmFtZXNwYWNlICsgJy1yZXN1bHQnO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdyZXN1bHQnKTtcbiAgICAgICAgdGhpcy5pbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuaW5wdXQuaWQgPSB0aGlzLm5hbWVzcGFjZSArICctaW5wdXQnO1xuICAgICAgICB0aGlzLmlucHV0LmNsYXNzTGlzdC5hZGQoJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuaW5wdXQuYXV0b2ZvY3VzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgICB0aGlzLmJ1dHRvbi5pZCA9IHRoaXMubmFtZXNwYWNlICsgJy1idXR0b24nO1xuICAgICAgICB0aGlzLmJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdidXR0b24nKTtcbiAgICAgICAgdGhpcy5idXR0b24uaW5uZXJIVE1MID0gJ0Nsb3NlJztcbiAgICAgICAgdGhpcy50aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB0aGlzLnRpbWUuaWQgPSB0aGlzLm5hbWVzcGFjZSArICctdGltZSc7XG4gICAgICAgIHRoaXMudGltZS5jbGFzc0xpc3QuYWRkKCd0aW1lJyk7XG4gICAgICAgIHRoaXMuY291bnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHRoaXMuY291bnQuaWQgPSB0aGlzLm5hbWVzcGFjZSArICctY291bnQnO1xuICAgICAgICB0aGlzLmNvdW50LmNsYXNzTGlzdC5hZGQoJ2NvdW50Jyk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuaW5wdXQpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmJ1dHRvbik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY291bnQpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnRpbWUpO1xuICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZSh0aGlzLmNvbnRhaW5lciwgZG9jdW1lbnQuYm9keS5maXJzdENoaWxkKTtcblxuICAgICAgICB0aGlzLmFkZExpc3RlbmVycygpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBJbnB1dC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG4gICAgICAgIGlmICghdGhpcy5pbnB1dCkge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQodmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgSW5wdXQucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIElucHV0LnByb3RvdHlwZS5hZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuaW5wdXQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB0aGlzLmNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5idXR0b24pIHtcbiAgICAgICAgICAgIHRoaXMuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBJbnB1dC5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5lbmFibGUoKS5oaWRlKCk7XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgSW5wdXQucHJvdG90eXBlLnNldFRpbWUgPSBmdW5jdGlvbiAodGltZSkge1xuXG4gICAgICAgIGlmICh0aGlzLnRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMudGltZS5pbm5lckhUTUwgPSB0aW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIElucHV0LnByb3RvdHlwZS5zZXRDb3VudCA9IGZ1bmN0aW9uIChjb3VudCkge1xuXG4gICAgICAgIGlmICh0aGlzLmNvdW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50LmlubmVySFRNTCA9IGNvdW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIHJldHVybiBJbnB1dDtcbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgSW5wdXQgPSByZXF1aXJlKCcuL2lucHV0Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgU1RBUlRfTEVOR1RIID0gMyxcbiAgICAgICAgX2lzQnVzeSA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gU2VhcmNoZXIobmFtZXNwYWNlKSB7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlO1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMubmFtZXNwYWNlICsgJy1jb250YWluZXInKTtcbiAgICAgICAgdGhpcy5pdGVtUHJlZml4ID0gdGhpcy5uYW1lc3BhY2UgKyAnLWNvbnRhaW5lci1pdGVtLSc7XG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IFtdO1xuICAgICAgICB0aGlzLnRpbWUgPSB7XG4gICAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICAgIGVuZDogMFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMub25Mb2FkKCkuYWRkS2V5TGlzdGVuZXIoKTtcbiAgICB9XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUub25Mb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaTtcblxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLmNvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpO1xuXG4gICAgICAgICAgICBmb3IgKGkgPSB0aGlzLml0ZW1zLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXNbaV0uaWQgPSB0aGlzLml0ZW1QcmVmaXggKyBpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZVt0aGlzLnN0b3JhZ2UubGVuZ3RoXSA9IHRoaXMuaXRlbXNbaV0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmJpbmFyeVNlYXJjaCA9IG5ldyBXb3JrZXIoJ2FwcC9iaW5hcnktc2VhcmNoLmpzJyk7XG4gICAgICAgICAgICB0aGlzLmlucHV0ID0gbmV3IElucHV0KHRoaXMubmFtZXNwYWNlICsgJy1pbnB1dCcsIHRoaXMub25JbnB1dC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSAnJztcblxuICAgICAgICAgICAgdGhpcy5hZGRXb3JrZXJMaXN0ZW5lcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5pc0FsbG93ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhX2lzQnVzeSAmJiB0aGlzLnZhbHVlLmxlbmd0aCA+PSBTVEFSVF9MRU5HVEg7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5hZGRLZXlMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCB0aGlzLm9uS2V5LmJpbmQodGhpcykpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUucmVtb3ZlS2V5TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgdGhpcy5vbktleS5iaW5kKHRoaXMpKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uS2V5ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICAgICAgaWYgKCFfaXNCdXN5KSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWxsb3dlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCkucmVtb3ZlS2V5TGlzdGVuZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBpZiAodGhpcy5pbnB1dCkge1xuICAgICAgICAgICAgdGhpcy5pbnB1dC5zaG93KHRoaXMudmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQodGhpcy52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZWFyY2goKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uSW5wdXQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcblxuICAgICAgICB0aGlzLnNlYXJjaCgpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBTZWFyY2hlci5wcm90b3R5cGUuYWRkV29ya2VyTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYmluYXJ5U2VhcmNoLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNBbGxvd2VkKCkpIHtcbiAgICAgICAgICAgIHRoaXMudGltZS5zdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XG4gICAgICAgICAgICB0aGlzLmJpbmFyeVNlYXJjaC5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgYXJyOiB0aGlzLnN0b3JhZ2UsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfaXNCdXN5ID0gdHJ1ZTtjXG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIFNlYXJjaGVyLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9pc0J1c3kgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgU2VhcmNoZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgaTtcblxuICAgICAgICB0aGlzLnRpbWUuZW5kID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIHRoaXMuZW5hYmxlKClcbiAgICAgICAgICAgIC5pbnB1dC5zZXRUaW1lKHRoaXMudGltZS5lbmQgLSB0aGlzLnRpbWUuc3RhcnQpLnNldENvdW50KGV2ZW50LmRhdGEubGVuZ3RoKTtcblxuICAgICAgICBmb3IgKGkgPSBldmVudC5kYXRhLmxlbmd0aDsgaS0tOykge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5pdGVtUHJlZml4ICsgZXZlbnQuZGF0YVtpXSkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNlYXJjaGVyO1xufSkoKTsiXX0=
